---
import NavigationBar from "./NavigationBar.astro";
---

<div id="scroll-container" class="container h-2screen">
	<div class="hero flex justify-center items-center">
		<div class="mask">
			<img src="/images/chef/hero.jpg" id="hero-image" />
		</div>
	</div>
</div>

<div class="scroll-indicator">
	<div class="scroll-arrow"></div>
</div>

<script>
	import { gsap } from "gsap";
	import { ScrollTrigger } from "gsap/ScrollTrigger";

	gsap.registerPlugin(ScrollTrigger);

	document.addEventListener("DOMContentLoaded", () => {
		const scrollIndicator = document.querySelector(".scroll-indicator");
		const scrollContainer = document.querySelector("#scroll-container");
		const hero = document.querySelector(".hero");
		const heroImage = document.querySelector("#hero-image");
		const maskEl = document.querySelector(".mask");
		const heroInnerImg = heroImage?.querySelector("img");

		console.log("Elements found:", scrollContainer, hero);

		// Scroll-based transformations
		if (scrollContainer && hero) {
			// Pin the hero container until its bottom reaches the bottom of the viewport
			ScrollTrigger.create({
				trigger: scrollContainer,
				start: "top top",
				end: "bottom bottom",
				pin: true,
				// markers: true // Uncomment to see trigger points
			});

			// Keep hero-image circular and scale to cover the container by end
			if (heroImage) {
				// gsap.set(heroImage, {
				// 	willChange: "transform",
				// });

				if (maskEl) {
					const radiusForFullCover = () =>
						Math.hypot(window.innerWidth, window.innerHeight) / 2;

					const tl = gsap.timeline({
						scrollTrigger: {
							trigger: scrollContainer,
							start: "top top",
							end: "bottom bottom",
							scrub: true,
						},
					});

					// Initial state: small centered circle
					tl.set(maskEl, {
						clipPath: "circle(12.5vw at 50% 50%)",
						WebkitClipPath: "circle(12.5vw at 50% 50%)",
					});

					// 0% -> 80%: grow the circle, remain centered
					tl.to(
						maskEl,
						{
							clipPath: () =>
								`circle(${radiusForFullCover()}px at 50% 50%)`,
							WebkitClipPath: () =>
								`circle(${radiusForFullCover()}px at 50% 50%)`,
							ease: "none",
							duration: 0.8,
						},
						0,
					);

					// Recompute target radius on resize
					window.addEventListener("resize", () => {
						tl.invalidate();
						ScrollTrigger.refresh();
					});
				}
			}

			// Animate the hero text
			// gsap.to(hero, {
			// 	scale: 1,
			// 	opacity: 0,
			// 	top: "-100vh",
			// 	duration: 1,
			// 	ease: "none",
			// 	scrollTrigger: {
			// 		trigger: scrollContainer,
			// 		start: "top top",
			// 		end: "+=100vh",
			// 		scrub: true,
			// 		// markers: true
			// 	},
			// });

			// Scroll indicator fade out
			if (scrollIndicator) {
				gsap.to(scrollIndicator, {
					opacity: 0,
					y: -30,
					duration: 0.5,
					ease: "none",
					scrollTrigger: {
						trigger: scrollContainer,
						start: "top top",
						end: "+=20vh",
						scrub: true,
					},
				});
			}
		}
	});
</script>

<style>
	.h-2screen {
		height: 200vh;
	}

	#hero-image {
		width: 100vw;
		height: 100vh;
		object-fit: cover;
		display: block;
	}

	.mask {
		width: 100vw;
		height: 100vh;
		overflow: hidden;
		clip-path: circle(12.5vw at 50% 50%);
		-webkit-clip-path: circle(12.5vw at 50% 50%);
		border: none; /* avoid rectangular border implying the mask is a rect */
	}
</style>
